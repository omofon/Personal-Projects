<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Accessible popover demo</title>
    <style>
      :root {
        --gap: 8px;
        font-family: system-ui, sans-serif;
      }
      body {
        padding: 3rem;
      }
      .btn {
        padding: 0.6rem 1rem;
        border-radius: 6px;
      }
      .popover {
        position: absolute;
        min-width: 180px;
        padding: 0.6rem;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        background: white;
        display: none;
        z-index: 1000;
      }
      .popover[data-open="true"] {
        display: block;
      }
    </style>
  </head>
  <body>
    <button
      id="trigger"
      class="btn"
      aria-haspopup="true"
      aria-expanded="false"
      aria-controls="p"
    >
      Open
    </button>

    <div id="p" class="popover" role="dialog" aria-modal="false" tabindex="-1">
      <p><strong>Popover title</strong></p>
      <p>Some interactive content here. <a href="#">Link</a></p>
      <button id="close">Close</button>
    </div>

    <script>
      const trigger = document.getElementById("trigger");
      const pop = document.getElementById("p");
      const closeBtn = document.getElementById("close");

      function open() {
        const r = trigger.getBoundingClientRect();
        pop.style.left = `${r.left + window.scrollX}px`;
        pop.style.top = `${r.bottom + window.scrollY + 8}px`;
        pop.setAttribute("data-open", "true");
        trigger.setAttribute("aria-expanded", "true");
        pop.focus();
        requestAnimationFrame(() =>
          document.addEventListener("pointerdown", outside)
        );
        document.addEventListener("keydown", onKey);
      }
      function close() {
        pop.removeAttribute("data-open");
        trigger.setAttribute("aria-expanded", "false");
        trigger.focus();
        document.removeEventListener("pointerdown", outside);
        document.removeEventListener("keydown", onKey);
      }
      function outside(e) {
        if (!pop.contains(e.target) && !trigger.contains(e.target)) close();
      }
      function onKey(e) {
        if (e.key === "Escape") close();
      }

      trigger.addEventListener("click", () => {
        if (pop.getAttribute("data-open") === "true") close();
        else open();
      });
      closeBtn.addEventListener("click", close);
    </script>
  </body>
</html>
